window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem);
Registry.require("promise layout convert xmlhttprequest crcrc curtain tools layout/default/tabview layout/default/htmlutil helper statistics i18n syncinfo uri layout/default/layout_helper porter hinter cloud".split(" "),function(){var z=rea.FEATURES,D=Registry.get("promise"),w=Registry.get("crcrc").cr,k=Registry.get("crcrc").crc,Na=Registry.get("layout/default/tabview"),n=Registry.get("layout/default/htmlutil"),fb=Registry.get("statistics"),Oa=Registry.get("syncinfo"),gb=Registry.get("convert"),wa=
Registry.get("tools"),q=Registry.get("curtain"),e=Registry.get("i18n"),x=Registry.get("helper"),xa=Registry.get("uri"),W=Registry.get("porter"),ya=Registry.get("hinter"),za=Registry.get("layout"),ka=Registry.get("layout/default/layout_helper"),K=ka.images,la=Registry.get("cloud"),Aa=wa.cache;za.render(function(){ka.addStyle();var ra={},r={},C=[],Ba="0.0.0",Y={},Pa={},T={},ba=!0,ma=!1,G,v={},I=function(a,b){var c,d;if((c=v[a])&&(d=c[b]))return d.apply(this,Array.prototype.slice.call(arguments,2))},
ca=-1!=window.navigator.userAgent.indexOf("Mac")?"mac":"other";window.addEventListener("keydown",function(a){var b,c=!1;if("keydown"==a.type){if(27==a.keyCode){b=G.getTabById("dashboard");if(!b.isSelected())return;if(a.target&&"text"==a.target.type){$(a.target).blur();return}v.multiselect.toggleRow(!1);c=!0}else if(("mac"!=ca&&39==a.keyCode||"mac"==ca&&40==a.keyCode)&&!a.ctrlKey&&a.altKey&&!a.shiftKey){if(b=G.getNextTab())b.select(),c=!0}else("mac"!=ca&&37==a.keyCode||"mac"==ca&&38==a.keyCode)&&!a.ctrlKey&&
a.altKey&&!a.shiftKey&&(b=G.getPreviousTab())&&(b.select(),c=!0);if(c)return a.stopPropagation(),a.preventDefault(),!1}},!0);window.addEventListener("keydown",function(a){var b,c,d=!1;if("keydown"==a.type){if(112==a.keyCode)(b=G.getTabById("help"))&&b.select(),d=!0;else if((38==a.keyCode||40==a.keyCode)&&a.shiftKey){b=G.getTabById("dashboard");if(!b.isSelected())return;if((b=J.length&&J[J.length-1])&&(b=$(b))&&(d=!0,c=b.closest("tr"),c.length)){var m;38==a.keyCode?(c=c.prevAll("tr:visible:first"),
m=!0):(c=c.nextAll("tr:visible:first"),m=!1);if(c.length){var f,e=c.find('input[name="scriptselectors"]');-1!=J.indexOf(e[0])?(J.pop(),b.prop("checked",!1),b.removeClass("selected"),f=b):e.length&&(e.prop("checked",!0),e.addClass("selected"),J.push(e[0]),void 0===J.direction&&(J.direction=m),f=e);f&&(n.isScrolledIntoView(c,{padding:100})||$("html, body").animate({scrollTop:m?c.offset().top-100-c.height():c.offset().top-$(window).height()+100+2*c.height()},0),v.multiselect.single_click())}}}else if(70==
a.keyCode&&(a.ctrlKey||a.metaKey)){b=G.getTabById("dashboard");if(!b.isSelected())return;v.multiselect.toggleRow(!0,!0);d=!0}else if(65==a.keyCode&&(a.ctrlKey||a.metaKey)){b=G.getTabById("dashboard");if(!b.isSelected()||a.target&&"text"==a.target.type)return;v.multiselect.un_selectAll(!0);d=!0}if(d)return a.stopPropagation(),a.preventDefault(),!1}},!1);var V,M=function(){var a={};window.onhashchange=function(){V=x.getUrlArgs(!0);Object.keys(a).forEach(function(d){d=a[d];b.is(d.main,d.sub)&&d.fn()})};
window.onhashchange();var b={set:function(a){var c=b.get(),e;e="object"===typeof a?[a.main,a.sub].filter(function(a){return a}):arguments;if(c.main!==e[0]||c.sub!==e[1])!e[0]&&e[1]?b.setSub(e[1]):window.location.hash="nav="+Array.prototype.join.call(e,"+")},setSub:function(a){var c=b.get();c.sub!==a&&(window.location.hash="nav="+(c.main?c.main:"")+"+"+a)},get:function(){var a=V.nav?V.nav.split("+"):[];return{main:a[0],sub:a[1]}},is:function(a,c){var e=b.get(),h=!c||e.sub===c;return(!a||e.main===a)&&
h},isSub:function(a){return b.is(null,a)},registerListener:function(d,c,e){void 0===e&&(e=c,c=null);var h=[d,c].join("+");a[h]={main:d,sub:c,fn:e};b.is(d,c)&&e();return h},unregisterListener:function(b){delete a[b]},clear:function(){b.set("")}},c=b.get();C.push(function(){var a=G.getTabById(c.main);if(a)return a.select();if(c.main)(a=G.getTabById("dashboard"))&&a.select(),C.push(function(){window.setTimeout(function(){b.set(c)},1)});else window.onhashchange()});return b}();(function(){C.push(function(){r.statistics_enabled&&
fb.init("opt",Ba)})})();var Ca=x.getDebouncer(1E3),Da=function(){for(;C.length;)try{C.shift()()}catch(a){console.warn("doneListeners:",a)}},wa=function(a,b){var c=w("input",a.name,a.id,"Save");c.inserted||(c.type="button",c.section=a,c.value=e.getMessage("Save"),c.addEventListener("click",function(){if(!b||!b.warning||na(b.warning)){var a=Array.prototype.slice.call(this.section.getElementsByTagName("textarea")),c=function(b){b.each(function(b,c){a.push(c)})};c($("#"+this.section.id).find("input"));
c($("#"+this.section.id).find("select"));for(var c=[],e=[],h=0;h<a.length;h++){var g=null,l=a[h],t=l.key;if(-1==e.indexOf(l)){if("textarea"==l.tagName.toLowerCase())l.named?(l=document.getElementsByName(l.name),g=[],x.each(l,function(a){g.push({name:a.named_name,value:a.value});e.push(a)})):g=l.array?l.value.split("\n").map(function(a){return a.trim()}).filter(function(a){return a}):l.value;else if("checkbox"==l.getAttribute("type"))g=l.checked;else if("select"==l.getAttribute("type")){var p=0;0<=
l.selectedIndex&&l.selectedIndex<l.options.length&&(p=l.selectedIndex);g=l[p]?l[p].value:l.options[0].value}else"button"!=l.getAttribute("type")&&(g=l.value);t&&c.push(sa(t,g,b&&b.reload))}}b&&b.reload&&(q.wait(),D.when(c).done(function(){rea.page.reload()}))}},!1));return c},jb=function(a){var b=function(a,b,c,d,e){var l,m=k("th","settingsth",a.name,a.id,b),g=k("a","settingsth_a",a.name,a.id,b+"_a");g.setAttribute("name","settingsth_a"+a.name);var h=k("a","settingsth_a_up",a.name,a.id,b+"_a_up");
h.setAttribute("name","settingsth_a_up"+a.name);var A=k("a","settingsth_a_down",a.name,a.id,b+"_a_down");A.setAttribute("name","settingsth_a_down"+a.name);var f=function(){var b=document.getElementsByName("settingsth_a_up"+a.name),c=document.getElementsByName("settingsth_a_down"+a.name);for(l=0;l<b.length;l++)b[l].style.display="none";for(l=0;l<c.length;l++)c[l].style.display="none";"up"==ea()?h.style.display="":A.style.display=""},p=function(){f()};b=function(){window.setTimeout(function(){aa()==
d?Ta("down"==ea()?"up":"down"):Ua(d);Va(p)},1)};m.inserted||(m.appendChild(g),m.appendChild(A),m.appendChild(h),g.addEventListener("click",b),h.addEventListener("click",b),A.addEventListener("click",b),g.textContent=c+" ",g.href="#",h.innerHTML="&#x25B4;",h.href="#",A.innerHTML="&#x25BE;",A.href="#");e&&!aa()?(Ua(d),Ta("up"),window.setTimeout(f,1)):d==aa()&&window.setTimeout(f,1);return m},c,d,m,f,h;f=w("tbody",a.name,a.id,"body");h=w("thead",a.name,a.id,"head");if(a.scriptTab){var g=hb(a),l=ib(a);
c=w("table",a.name,a.id,"main");c.inserted||c.setAttribute("class","scripttable multiselect");var t=k("th","script_sel",a.name,a.id,"thead_sel");t.appendChild(g.selAllm);var p=k("th","left",a.name,a.id,"thead_multi_action");p.setAttribute("colspan","12");p.appendChild(g.actionBox);p.appendChild(l);p.appendChild(g.close);m=k("tr","multiselectrow scripttr",a.name,a.id,"filler_multi");m.appendChild([t,p]);l=k("th","script_sel",a.name,a.id,"thead_sel");l.appendChild(g.selAll);var g=b(a,"thead_pos","#",
"pos"),t=b(a,"thead_en",e.getMessage("Enabled"),"enabled"),p=b(a,"thead_name",e.getMessage("Name"),"name",!0),y=b(a,"thead_ver",e.getMessage("Version"),"ver"),L=k("th","settingsth ",a.name,a.id,"thead_type"),A=k("span","script_type",a.name,a.id,"thead_type_span");A.textContent=e.getMessage("Type");L.appendChild(A);var B=k("th","settingsth",a.name,a.id,"thead_sync");B.textContent="";A=b(a,"thead_sites",e.getMessage("Sites"),"sites");A.width="25%";var F=k("th","settingsth",a.name,a.id,"thead_features");
F.textContent=e.getMessage("Features");var n=b(a,"thead_homepage",e.getMessage("Homepage"),"homepage"),b=b(a,"thead_updated",e.getMessage("Last_updated"),"updated"),u=k("th","settingsth",a.name,a.id,"thead_sort"),q=k("span","sorting",a.name,a.id,"thead_sort_span");q.textContent=e.getMessage("Sort");"pos"==aa()&&"up"==ea()||q.setAttribute("style","display: none;");u.appendChild(q);q=k("th","settingsth",a.name,a.id,"thead_del");q.textContent=e.getMessage("Actions");C.push(function(){r.sync_enabled&&
(B.textContent=e.getMessage("Imported"))});d=k("tr","scripttr multiselectreplaced",a.name,a.id,"filler");x.each([l,g,t,p,y,L,B,A,F,n,b,u,q],function(a){d.appendChild(a)});h.appendChild(m);h.appendChild(d);d.inserted||(v.multiselect.checkScroll=function(){var a=$(h).is(":visible")&&$(m).is(":visible")&&$(window).scrollTop()>$(h).offset().top;$(m).toggleClass("multiscrolling",a)},$(window).scroll(v.multiselect.checkScroll))}else c=k("table","settingstable",a.name,a.id,"main");c.appendChild(h);c.appendChild(f);
return{table:c,head:h,body:f}},Wa=function(a,b,c,d){var e,f,h,g,l,t=[];if(b.divider)return null;b.image&&(b.imageURL=K.get(b.image));if(b.checkbox)h=function(){var a=!0,b=this;b.warning&&(a=na(b.warning),a||(b.checked=!b.checked));a&&sa(this.key,b.checked,b.reload).always(function(){b.reload&&rea.page.reload()})},c&&c.need_save&&(h=f=null),e=n.createCheckbox(b.name,b,h),t.push(e.elem);else if(b.button)e=n.createButton(b.name,b,function(){var a=!0,b=this;b.warning&&(a=na(b.warning));a&&kb(b.key,b.data,
b.ignore).always(function(){b.reload&&rea.page.reload()})}),t.push(e);else if(b.named)e=n.createNamedSettings(b.name,b),t.push({element:e.elem,validation:e.label}),c&&(c.need_save=!0);else if(b.input)e=n.createTextarea(b.name,b),t.push({element:e.elem,validation:e.label}),c&&(c.need_save=!0);else if(b.text)e=n.createInput(b.name,b),t.push(e.elem),c&&(c.need_save=!0);else if(b.color)e=n.createColorChooser(b.name,b),t.push(e.elem),c&&(c.need_save=!0);else if(b.password)e=n.createPassword(b.name,b),
t.push(e.elem),c&&(c.need_save=!0);else if(b.select)f=function(){var a=!0,b=this;b.warning&&(a=na(b.warning),a||(b.value=b.oldvalue));a&&sa(b.key,n.getValue(b),b.reload).always(function(){b.reload&&rea.page.reload()})},c&&c.need_save&&(f=b.enabler?function(){var a=document.getElementsByName("enabled_by_"+this.key),b=(this.selectedIndex<this.options.length?this.options[this.selectedIndex]:this.options[0]).getAttribute("enables"),c=b?JSON.parse(b):{};x.each(a,function(a){void 0===c[a.key]||c[a.key]?
a.setAttribute("style",x.staticVars.visible):a.setAttribute("style",x.staticVars.invisible)})}:null),e=n.createDropDown(b.name,b,b.select,f,function(){var a=!0;this.selectedOptions.length&&this.selectedOptions[0].warning&&this.selectedOptions[0].value!==this.oldvalue&&(a=na(this.selectedOptions[0].warning),a||(this.value=this.previousValue||this.oldvalue));this.previousValue=this.value}),t.push(e.elem),a&&b.enabler&&function(){var a=f,b=e;C.push(function(){a.apply(b.select,[])})}();else if(b.url)h=
w("a",b.name,b.id),h.href="#",h.url=b.url,h.newtab=b.newtab,h.inserted||(f=function(){Ga(this.url,this.newtab)},h.addEventListener("click",f)),h.textContent=b.name,t=Array(13),t[3]=h;else if(b.main_menu_item){h=w("div",b.name,b.id);h.textContent=b.name;g=jb(b);l=w("div",b.name,b.id,"tab_content");l.appendChild(g.table);var p=null,y=d.appendTab(b.id,h,l,function(){p&&(ra.global?p():C.push(p));M.set(b.id);document.title=b.name});M.registerListener(b.id,function(){y.select()});b.referrer&&(p=function(){p=
null;q.wait();oa({referrer:b.referrer},function(b){b.items&&b.items.forEach(function(b){Wa(a,b,c,d)});Da();q.hide()})});b.items&&ta(g.body,b.items,null,d);!ra.global&&b.selected_default&&C.push(function(){d.getSelectedTab()||y.select()})}else b.sub_menu_item?(g=k("div","section",b.name,b.id,"section"),h=k("div","section_head",b.name,b.id,"head"),l=k("table","section_content",b.name,b.id,"content"),h.textContent=b.name,g.appendChild(h),b.desc&&n.setHelp(b.desc,h,h,b),g.appendChild(l),ta(l,b.items,
b,d),b.need_save&&l.appendChild(wa(l,b)),t.push(g)):b.userscript||b.nativeScript?(t=lb(b,a,d),b.userscript&&(T[b.uuid]={dom:a,script:b}),a.setAttribute("class","scripttr"),b.nnew?a.setAttribute("style","display: none;"):Ca.is("script_refresh")||(C.push(function(){Ha.init(x.map(T,function(a){return a.script}));v.multiselect.single_click();Va();ra.scripts=!0;Ca.clear()}),Ca.add("script_refresh")),b.nativeScript&&$("body").addClass("show_script_type")):b.version?(Ba=b.value,k("div","version","version",
"version").textContent="v"+Ba+" by Jan Biniok"):b.globalhint?Xa({class:b.class,text:b.value,title:b.description,onclick:b.info_url?function(){Ga(b.info_url,!0)}:null,image:b.image}):(h=w("span","",b.uuid||b.id+b.name),h.textContent=b.name,t=Array(13),t[3]=h);t.forEach(function(a){if(a){void 0!==b.level&&(a.element||a).setAttribute("style",b.level>r.configMode?x.staticVars.invisible:x.staticVars.visible||"");if(b.hint){var c=w("span","",b.uuid||b.id+b.name,"hint");c.textContent=b.hint;a.appendChild(c)}b.validation&&
mb(b,a.validation||a.element||a);b.width&&a.setAttribute("class","width-172-"+b.width)}});a&&(l=a.getAttribute("class"),h=" hide",!1===b.visible?l=(l||"")+h:l&&(l=l.replace(h,"")),a.setAttribute("class",l));return t},ta=function(a,b,c,d){Object.keys(b).forEach(function(e){var f=b[e],h=a?k("tr","settingstr",f.uuid||f.id+f.name,"pi"):null;(e=Wa(h,f,c,d))&&e.length&&(a&&a.appendChild(h),x.each(e,function(a,b){var c=a,d="";"Object"===x.toType(a)&&(c=a.element,d=a.style||"");d=k("td",d+"settingstd","",
f.uuid||f.id+f.name,b);a&&d.appendChild(c);h&&h.appendChild(d)}))})},na=function(a){var b=a.msg||a;if(a.once){if(Pa[b])return!0;Pa[b]=!0}var b=confirm(b),c={};b&&a.ok?c=a.ok:!b&&a.cancel&&(c=a.cancel);if(a.ok||a.cancel)b=!0;c.url&&sendMessage({method:"newTab",url:c.url},function(){});return b},mb=function(a,b){var c;a.validation&&(a.validation.url&&(c=function(){Ga(this.url,!0)}),a.validation.image&&(a.validation.imageURL=K.get(a.validation.image)),c=n.createAfterIcon(a,c))&&(c.url=a.validation?a.validation.url:
void 0,b.appendChild(c))},nb=function(a){return{source:a.code,meta:{name:a.name,uuid:a.uuid,modified:a.lastModified,file_url:a.file_url&&a.file_url.trim()?a.file_url:void 0},storage:a.storage,options:a.options,settings:{enabled:a.enabled,position:a.position}}},ua=function(a,b){var c=D(),d=[];ob(a,b).done(function(a){a.scripts.forEach(function(a){a.uuid&&a.userscript&&!a.system&&!a.nnew&&(a.code&&""!=a.code.trim()?d.push(nb(a)):console.log("options: Strange script: "+a.name))});c.resolve({scripts:d,
global_settings:a.global_settings})}).fail(function(){c.reject()});return c.promise()},pb=function(a){var b,c,d=w("div","help","help","tab_help_h"),m=d.textContent=e.getMessage("Help"),f=w("div","help","help","tab_help");return a.appendTab("help",d,f,function(){M.set("help");document.title=m;if(!c){q.wait();var a=k("div","section","help","help","ta"),d=k("div","section_head","help","help","head_ta"),l=k("div","section_content","help","help","content_ta");d.textContent=e.getMessage("Editor");a.appendChild([d,
l]);var t=k("dl","dl-horizontal shortcuts","help","help","dl");l.appendChild(t);d=k("dt","keymapping","help","help","dt_mapping");b=k("dd","keymapping","help","help","dd_mapping");d.textContent=e.getMessage("Key_Mapping");b.textContent=r.editor_keyMap;t.appendChild([d,b]);if("vim"==r.editor_keyMap)b=k("dd","keymapping","help","help","dd_unsup"),b.textContent=e.getMessage("Please_check_the_0editor0_documentation_for_more_details_","VIM"),t.appendChild(b);else if("emacs"==r.editor_keyMap)b=k("dd","keymapping",
"help","help","dd_unsup"),b.textContent=e.getMessage("Please_check_the_0editor0_documentation_for_more_details_","Emacs"),t.appendChild(b);else{var p=[];c={};var y=function(a){a=a.split(/-+/);var b=a.pop(),c=[],d="";-1!=(d=["up","down","left","right"].indexOf(b.toLowerCase()))&&c.push("#cursor");b.toLowerCase().match(/f[0-9]{1,2}/)&&c.push("#function");return c.length?c.join("-")+a.join("-")+d+b:("0000"+(100-Math.min(b.length,4))).slice(-4)+b+a.join("-")};[x.assign({Esc:"backOrClose"},"mac"!=ca?{"Alt-Left":"previousTab",
"Alt-Right":"nextTab"}:{"Alt-Up":"previousTab","Alt-Down":"nextTab"}),CodeMirror.keyMap[r.editor_keyMap],"mac"!=ca?CodeMirror.keyMap.pcDefault:CodeMirror.keyMap.macDefault,CodeMirror.keyMap["default"]].forEach(function(a){Object.keys(a).forEach(function(b){c[b]||"fallthrough"==b||(p.push({name:b,fn:a[b].replace?a[b].replace(/([A-Z])/g," $1").replace(/ [A-Z]/g,function(a){return a.toLowerCase()}):a[b],sort:y(b)}),c[b]=!0)})});p.sort(function(a,b){return a.sort<b.sort?-1:a.sort>b.sort?1:0});p.forEach(function(a){var b=
w("dt","help","help","dt_"+a.sort),c=w("dd","help","help","dd_"+a.sort);b.textContent=a.name;c.textContent=a.fn;t.appendChild([b,c])})}f.appendChild(a);q.hide()}})},pa=function(){if(z.RUNTIME.FIREFOX)return window.saveAs=function(a,c){var d=URL.createObjectURL(a);qb(d,c,function(){URL.revokeObjectURL(d)})},D.Pledge();if(z.RUNTIME.EDGE&&window.navigator&&window.navigator.msSaveBlob)return window.saveAs=function(a,c){window.navigator.msSaveBlob(a,c)},D.Pledge();var a=D();Registry.vendor(["vendor/saveas/filesaver"],
function(){pa=D.Pledge;a.resolve()});return a.promise()},sb=function(a){var b=w("div","utils","utils","tab_util_h"),c=b.textContent=e.getMessage("Utilities"),d=w("div","utils","utils","tab_util");a.appendTab("utils",b,d,function(){M.set("utils");document.title=c}).show();a=k("div","tv_util","utils","utils","tab_util_cont");var m=function(){la.init(function(a){var b=D(),c=rea.extension.connect("tabWatch");c.onMessage.addListener(function(a){(a=a.tab)?b.notify(a):(c.disconnect(),b.resolve())});c.onDisconnect.addListener(function(){b.reject("auth_failed")});
c.postMessage({method:"tabWatch",type:a.type,url:a.url});return{promise:b.promise(),close:function(){c.disconnect()}}});m=null},f=function(){return ua(null,{storage:ba,global_settings:ma}).then(function(a){q.wait();return W.zip.create(a.scripts,a.global_settings).progress(q.wait)})},h=function(a){var b=D(),c=new FileReader;c.onload=function(a){b.resolve(a.target.result)};c.readAsText(a);return b.promise()},g=function(a){for(var b=0,c;c=a[b];b++)W.zip.read(c).progress(q.wait).then(function(a){return Ia({scripts:x.map(a.scripts,
function(a){var b=a.meta||{},c=a.settings||{};return{source:a.source,name:b.name,uuid:b.uuid,file_url:b.file_url,options:a.options,storage:a.storage,lastModified:b.modified,enabled:c.enabled,position:c.position}}),global_settings:a.global_settings},{reload:!0})}).done(function(a){a.err&&x.alert(a.err)}).fail(function(){x.alert(e.getMessage("Unable_to_parse_this_"))}).always(q.hide)},l=n.createButton("utils","utils_i_ta",e.getMessage("Import"),function(){W.json.read(v.value).then(function(a){return Ia(a,
{reload:!0})}).done(function(a){a.err&&x.alert(a.err)}).fail(function(){x.alert(e.getMessage("Unable_to_parse_this_"))})}),t=n.createFileSelect(e.getMessage("Import"),{name:"zip",id:"utils"},function(a){q.wait();return g(a)}),p=n.createFileSelect(e.getMessage("Import"),{name:"file",id:"utils"},function(a){q.wait();for(var b,c=0;b=a[c];c++)h(b).then(function(a){return W.json.read(a)}).then(function(a){return Ia(a,{reload:!0})}).done(function(a){a.err&&x.alert(a.err)}).fail(function(){x.alert(e.getMessage("Unable_to_parse_this_"))}).always(q.hide)}),
y=n.createButton("utils","utils_i_cloud",e.getMessage("Show_backups"),function(){q.wait();var a=H.select.value,b=H.select.selectedOptions[0].text;m&&m();la[a].list().progress(function(a){0<a.total&&q.wait(b+": "+Math.floor(a.loaded/a.total*100)+"%")}).then(function(a){a=a.filter(function(a){return a.name.match(/\.zip$/)});return a.length?a:D().reject("empty")}).then(function(b){var c=D(),d=$('<table class="nowrap file_select">');$('<thead><tr><th colspan="3">'+e.getMessage("Please_select_a_file")+
":</th></tr></thead>").appendTo(d);b.sort(function(a,b){return a.modified-b.modified}).forEach(function(b){var l=$('<input class="button" type="button" value="'+e.getMessage("Import")+'">').click(function(){c.resolve(b);q.hideDialog();q.wait()}),h=$('<input class="button" type="button" value="'+e.getMessage("Delete")+'">').click(function(){g.hide();la[a].delete(b)}),g=$("<tr><td>"+[n.safeTagsReplace(b.name),ka.formatBytes(b.size,2),(new Date(b.modified)).toLocaleString().replace((new Date).toLocaleDateString(),
e.getMessage("Today"))].join("</td><td>")+"</td></tr>");$("<td>").append(l,h).appendTo(g);g.appendTo(d)});b=$('<input class="button" type="button" value="'+e.getMessage("Cancel")+'">').click(function(){c.reject("cancel");q.hideDialog()});$("<tfoot>").append($("<tr>").append($('<td colspan="3">').append(b))).appendTo(d);q.hide();q.dialog(d[0]);return c.promise()}).then(function(c){return la[a].get(c).progress(function(a){0<a.total&&q.wait(b+": "+Math.floor(a.loaded/a.total*100)+"%")})}).then(function(a){return g([a])}).fail(function(a){var b;
"empty"===a?b=e.getMessage("No_backups_found"):"cancel"!=a&&("auth_failed"==a?console.warn("cloud: Authentication failed"):b=e.getMessage("Error")+": "+a);b&&x.alert(b);q.hide()})}),b=n.createButton("utils","utils_i_url",e.getMessage("Import"),function(){q.wait();return rb(N.value,{reload:!0}).fail(function(a){a=a.err?a.err:e.getMessage("Unable_to_parse_this_");x.alert(a)}).always(q.hide)}),L=n.createButton("utils","utils_e_ta",e.getMessage("Export"),function(){q.wait();ua(null,{storage:ba,global_settings:ma}).then(function(a){return W.json.create(a.scripts,
a.global_settings)}).done(function(a){v.value=a}).always(q.hide)}),A=n.createButton("utils","utils_e_file",e.getMessage("Export"),function(){q.wait();ua(null,{storage:ba,global_settings:ma}).then(function(a){return W.json.create(a.scripts,a.global_settings).then(function(a){return pa().done(function(){var b=new Blob([a],{type:"text/plain"});saveAs(b,"tampermonkey-backup-"+z.RUNTIME.BROWSER+"-"+(new Date).toISOString()+".txt")})})}).always(q.hide)}),B=n.createButton("utils","utils_e_zip",e.getMessage("Export"),
function(){return f().then(function(a){return pa().done(function(){saveAs(a,x.safeFileName("tampermonkey-backup-"+z.RUNTIME.BROWSER+"-"+(new Date).toISOString()+".zip"))})}).always(q.hide)}),F=n.createButton("utils","utils_e_zip",e.getMessage("Export"),function(){var a=D(),b=H.select.value,c=H.select.selectedOptions[0].text,d=function(a){return f().then(function(d){q.wait(c+"...");m&&m();return la[b].put(a+".zip",d).progress(function(a){0<a.total&&q.wait(c+":"+Math.floor(a.loaded/a.total*100)+"%")})}).fail(function(a){x.alert(e.getMessage("Error")+
": "+a)}).always(q.hide)};x.prompt(e.getMessage("Name"),"backup-"+z.RUNTIME.BROWSER+"-"+(new Date).toISOString(),function(b){b?a.consume(d(b)):a.reject("aborted")});return a.promise()}),E=n.createCheckbox(e.getMessage("Include_TM_settings"),{id:"utils_e_export_tm_settings",enabled:"true"},function(){ma=this.checked});E.elem.setAttribute("style","padding-left: 2px");E.input.checked=ma;var u=n.createCheckbox(e.getMessage("Include_script_storage"),{id:"utils_e_export_storage",enabled:"true"},function(){ba=
this.checked});u.elem.setAttribute("style","padding-left: 2px; display: inline");u.input.checked=ba;var v=k("textarea","importta","utils","utils","ta");v.setAttribute("spellcheck","false");var Ea=k("div","section","utils","utils","ta"),Z=k("div","section_head","utils","utils","head_ta"),Fa=k("div","section_content","utils","utils","content_ta");Z.textContent=e.getMessage("General");Fa.appendChild(u.elem);Fa.appendChild(E.elem);Ea.appendChild(Z);Ea.appendChild(Fa);E=k("div","section","utils","utils",
"ta");u=k("div","section_head","utils","utils","head_ta");Z=k("div","section_content","utils","utils","content_ta");u.textContent=e.getMessage("TextArea");Z.appendChild(L);Z.appendChild(l);Z.appendChild(v);E.appendChild(u);E.appendChild(Z);l=k("div","section","utils","utils","sb");L=k("div","section_head","utils","utils","head_sb");u=k("div","section_content","utils","utils","content_sb");L.textContent=e.getMessage("Zip");l.appendChild(L);l.appendChild(u);u.appendChild(B);u.appendChild(t.elem);var t=
k("div","section","utils","utils","sb"),B=k("div","section_head","utils","utils","head_sb"),L=k("div","section_content","utils","utils","content_sb"),H=n.createDropDown(e.getMessage("Type"),{id:"cloud_type",value:"edge"==z.RUNTIME.BROWSER?"onedrive":"drive"},[{name:"Google Drive",value:"drive"},"safari"==z.RUNTIME.BROWSER?null:{name:"Dropbox",value:"dropbox"},{name:"OneDrive",value:"onedrive"}].filter(function(a){return a}),function(){});B.textContent=e.getMessage("Cloud");t.appendChild(B);t.appendChild(L);
L.appendChild(H.elem);L.appendChild(F);L.appendChild(y);y=k("div","section","utils","utils","fi");F=k("div","section_head","utils","utils","head_fi");B=k("div","section_content","utils","utils","content_fi");F.textContent=e.getMessage("File");y.appendChild(F);y.appendChild(B);B.appendChild(A);B.appendChild(p.elem);var N=k("input","updateurl_input","utils","utils","url");N.setAttribute("type","text");N.setAttribute("spellcheck","false");p=k("div","section","utils","utils","ur");A=k("div","section_head",
"utils","utils","head_ur");F=k("div","section_content","utils","utils","content_ur");A.textContent=e.getMessage("URL");p.appendChild(A);p.appendChild(F);F.appendChild(N);F.appendChild(b);a.appendChild(Ea);"undefined"!==typeof Blob&&a.appendChild(t);z.RUNTIME.CAN_SAVEAS_ZIP&&a.appendChild(l);"undefined"!==typeof Blob&&a.appendChild(y);a.appendChild(E);a.appendChild(p);x.each([E],function(a){var b=a.getAttribute("class"),b=50>r.configMode?b+" hide":b.replace(" hide","");a.setAttribute("class",b)});
d.appendChild(a)},tb=function(){var a=document.getElementById("options"),b=k("div","content_wrapper","options","main");if(a){var c=a.parentNode;c.removeChild(a);c.appendChild(b);document.body.setAttribute("class","main")}var a=k("div","head_container","opt","head_container"),c=k("div","tv_container_fit","opt","tv_container"),d=w("a","head_link","heads","head_link");d.href="http://tampermonkey.net";d.target="_blank";var e=k("div","float","heads","head1"),f=k("img","banner","heads");f.src=rea.extension.getURL("images/icon128.png");
var h=k("div","float head","heads","head2"),g=k("div","header_title","heads"),l=k("div","version","version","version");l.textContent=" by Jan Biniok";var t=w("div","search","box",""),p=k("div","footer","footer");g.textContent="Tampermonkey";e.appendChild(f);h.appendChild(g);h.appendChild(l);d.appendChild(e);d.appendChild(h);a.appendChild(d);a.appendChild(t);b.appendChild(a);b.appendChild(c);G=Na.create("_main",c);G.setFooter(p);C.unshift(function(){sb(G);pb(G)});C.push(function(){void 0!==V.contribute&&
window.setTimeout(Ya,100);ra.global=!0})},U=function(a,b,c,d){void 0===d&&(d={});var m=b.item,f=m.uuid+(d.orig||"")+b.id,h=(d.orig?"orig_":"use_")+b.id,g=function(a){return"select_"+x.createUniqueId(a,m.uuid)+"_sel1"},l=k("div","cludes",a,f,"cb1"),t=w("span",a,f,"cb2");if(d.orig){var p="merge_"+b.id,p=n.createCheckbox(a,{id:p,uuid:m.uuid,enabled:m.options&&m.options.override&&m.options.override[p]?!0:!1},function(){if("checkbox"==this.type){var a={};a[this.key]=this.checked;ga(this.uuid,a)}});t.appendChild(p.elem)}else t.textContent=
a;var y=k("select","cludes",h,m.uuid,"sel1");y.innerHTML="";y.setAttribute("size","6");y.setAttribute("multiple","true");for(h=0;h<c.length;h++)p=document.createElement("option"),p.value=p.text=c[h],y.appendChild(p);l.appendChild(t);m.desc&&n.setHelp(m.desc,l,t,m);l.appendChild(y);var L=function(a){var b=[];a=a&&a.options;for(var c=0,d=a.length;c<d;c++)a[c].selected&&b.push(a[c]);return b},h=function(){var a=g("use_"+("excludes"==b.id?"includes":"excludes")),c=document.getElementById(a),a=L(y),d=
!1,e="matches"==b.id;a.forEach(function(a){var b=e?"/"+xa.getRegExpFromMatch(a.value)+"/":a.value;a&&!c.querySelector('option[value="'+b+'"]')&&(a=a.cloneNode(!0),e&&(a.value=b,a.textContent=b),c.appendChild(a),d=!0)});d&&B()},p=function(){var a=prompt(e.getMessage("Enter_the_new_rule"));if(a){var b=document.createElement("option");b.value=b.text=a.trim();y.appendChild(b);B()}},t=function(){var a=y.options[y.selectedIndex];if(a){var b=prompt(e.getMessage("Enter_the_new_rule"),a.value);b&&(a.value=
a.text=b.trim(),B())}};c=function(){var a=!1;L(y).forEach(function(b){b&&(b.parentNode.removeChild(b),a=!0)});a&&B()};var A=function(a){for(var b=[],c=0;c<a.options.length;c++)b.push(a.options[c].value);return b},B=function(){var a={includes:A(document.getElementById(g("use_includes"))),matches:A(document.getElementById(g("use_matches"))),excludes:A(document.getElementById(g("use_excludes"))),connects:A(document.getElementById(g("use_connects"))),temp_connects:A(document.getElementById(g("use_temp_connects"))),
blockers:A(document.getElementById(g("use_blockers")))};ga(m.uuid,a);return!0};d.other_name?(a=w("button",a,f,"btn1",!0),a.textContent=e.getMessage("Add_as_0clude0",d.other_name),a.addEventListener("click",h,!1),l.appendChild(a)):d.orig||(d=w("button",a,f,"btn2",!0),d.textContent=e.getMessage("Add")+"...",d.addEventListener("click",p,!1),l.appendChild(d),d=w("button",a,f,"btn3",!0),d.textContent=e.getMessage("Edit")+"...",d.addEventListener("click",t,!1),l.appendChild(d),a=w("button",a,f,"btn4",!0),
a.textContent=e.getMessage("Remove"),a.addEventListener("click",c,!1),l.appendChild(a));return{elem:l}},Ja=function(a){return a.homepage?a.homepage:a.namespace&&0==a.namespace.search(/https?:\/\//)?a.namespace:null};Aa.create("sites").setOptions({timeout:600,check_interval:300,retimeout_on_get:!0}).init();var Ha=function(){var a={},b=function(a){return 7>a.toString().length?b("0"+a):a},c=function(a){if(a.includes||a.matches){for(var b={},c=[],e=a.includes.length?a.includes:a.matches,g=0;g<e.length;g++){var l=
e[g];if(l){var t=Aa.items.sites.get(l),p=void 0!==t?t:n.getInfoFromUrl(l);void 0===t&&Aa.items.sites.set(l,p);p&&p.dom?b[p.dom]||(b[p.dom]=!0,c.push({include:l,info:p})):c.push({include:l})}else console.log("o: Warn: script '"+a.name+"' has invalid include (index: "+g+")")}return c}};return{init:function(b){a={};b.forEach(function(b){(b=c(b))&&b.length&&b.forEach(function(b){b.info&&(a[b.info.dom]=(a[b.info.dom]||0)+1)})})},get:function(d){d=c(d);if(!d||!d.length)return b(0);d=x.map(d,function(b){return b.info?
{score:1E3*a[b.info.dom]+b.info.dom.charCodeAt(0)||0,dom:b.info.dom}:{score:0,dom:""}}).sort(function(a,b){return b.score-a.score})[0];return b(d.score)+d.dom},topIcons:function(b,e){var f,h=[],g=c(b);if(!g||!g.length)return[];g=x.map(g,function(b){b.score=b.info?a[b.info.dom]||0:0;return b}).sort(function(a,b){return b.score-a.score});x.each(g,function(a){var c=a.info;if(0==e--)return a=k("span","",b.uuid,"tbc"),a.textContent="...",h.push(a),!1;if(c){if("*"==c.tld)return f=n.createImage(K.get("web"),
"web",b.uuid,a.include,a.include),h.push(f),!1;var g="com",y="";"*"!=c.tld&&"tld"!=c.tld&&(g=c.tld);c.subdom.length&&(y=c.subdom.join(".")+".");g=(y+c.dom+"."+g).replace(/\*/g,"");y="http://"+g+"/";c=z.RUNTIME.CHROME?"chrome://favicon/"+y:null;g=0==y.search("http://userscripts.org/")||0==y.search("http://userscripts.com/")?K.origin("uso"):"native"==r.favicon_service?y+"favicon.ico":"duckduckgo"==r.favicon_service?"https://icons.duckduckgo.com/ip2/"+encodeURIComponent(g)+".ico":"https://www.google.com/s2/favicons?domain="+
encodeURIComponent(g);f=n.createFavicon([g,c,K.get("question_mark")].filter(function(a){return a}),"favicon",b.uuid,a.include,a.include)}else f=n.createFavicon(K.get("question_mark"),"favicon",b.uuid,a.include,a.include);h.push(f)});return h}}}(),aa=function(){if(z.HTML5.LOCALSTORAGE)return z.HTML5.LOCALSTORAGE.getItem("sort_key")},ea=function(){if(z.HTML5.LOCALSTORAGE)return z.HTML5.LOCALSTORAGE.getItem("sort_sequence")},Ua=function(a){if(z.HTML5.LOCALSTORAGE)return z.HTML5.LOCALSTORAGE.setItem("sort_key",
a)},Ta=function(a){if(z.HTML5.LOCALSTORAGE)return z.HTML5.LOCALSTORAGE.setItem("sort_sequence",a)},Va=function(a){var b=function(a,c){return a.tagName==c?a:a.parentNode?b(a.parentNode,c):null},c="down"==ea(),d=null,m=[],f=0,h=Date.now();Object.keys(T).forEach(function(a){var c=T[a];if(c)if(a=b(c.dom,"TR")){var g=b(a,"TBODY");d?g&&d!=g&&console.warn("options: different parents?!?!"):d=g;f++;var k,n;if(!(k=c.script.lastModified||c.script.lastUpdated)||(n=h-parseInt(k))&&isNaN(n))n=0;k=parseInt(c.script.version);
isNaN(k)&&(k=0);m.push({tr:a,sites:Ha.get(c.script),enabled:c.script.enabled,position:c.script.position?c.script.position:1E3+f,name:e.getTranslation(c.script,"name").toLowerCase(),homepage:[c.script.origin?xa.parse(c.script.origin.url).hostname:"z",Ja(c.script)?xa.parse(Ja(c.script)).hostname:"z"].join("_"),updated:n,version:k});a.inserted=!1;a.parentNode&&a.parentNode.removeChild(a)}else console.log("options: unable to sort script at pos "+c.pos);else console.warn("options: something went wrong!",
a)});m=function(a){var b;b=function(a){return function(b,c){return b[a]-c[a]}};var d=function(a){return function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0}},e=function(a,b){return function(c,d){var e=(b^c[a]?"a":"b")+c.name,g=(b^d[a]?"a":"b")+d.name;return e<g?-1:e>g?1:0}},g=aa();"pos"==g?b=b("position"):"enabled"==g?(b=e("enabled",c),c=null):b="ver"==g?b("version"):"updated"==g?b("updated"):d(g);a.sort(b);return a}(m);c&&(m=m.reverse());for(var g=0;g<f;g++)d.appendChild(m[g].tr);$(".sorting").each(function(a,
b){var c=$(b),d="pos"==aa()&&"up"==ea();c[d?"fadeIn":"fadeOut"]()});a&&a()},yb=function(a,b,c,d,m){c=w("div",b.uuid,"script_tab_head");var f=c.inserted,h=k("div","heading",b.uuid,"heading"),g=k("img","nameNicon64",b.uuid,"heading_icon"),l=b.icon64?b.icon64:b.icon;g.src=l;var t=k("div","nameNname64",b.uuid,"heading_name");t.textContent=e.getTranslation(b,"name");l&&h.appendChild(g);h.appendChild(t);g=k("div","author",b.uuid,"author");b.author?g.textContent="by "+b.author:b.copyright&&(g.innerHTML=
"&copy; ",g.textContent+=b.copyright);var l=k("table","noborder p100100",b.uuid,"table"),t=k("tr","script_tab_head",b.uuid,"tr1"),p=k("tr","details",b.uuid,"tr2"),n=k("td","",b.uuid,"td1"),q=k("td","",b.uuid,"td2");h.appendChild(g);c.appendChild(h);n.appendChild(c);t.appendChild(n);p.appendChild(q);l.appendChild(t);l.appendChild(p);d.appendChild(l);var A=Na.create("_details"+b.uuid,q,{tv:"tv tv_alt",tv_table:"tv_table tv_table_alt",tr_tabs:"tr_tabs tr_tabs_alt",tr_content:"tr_content tr_content_alt",
td_content:"td_content td_content_alt",td_tabs:"td_tabs td_tabs_alt",tv_tabs_align:"tv_tabs_align tv_tabs_align_alt",tv_tabs_fill:"tv_tabs_fill tv_tabs_fill_alt",tv_tabs_table:"tv_tabs_table tv_tabs_table_alt",tv_contents:"tv_contents tv_contents_alt",tv_tab_selected:"tv_tab tv_selected tv_tab_alt tv_selected_alt",tv_tab_close:"",tv_tab:"tv_tab tv_tab_alt",tv_content:"tv_content tv_content_alt"}),B=ub(b,A,m),F=b.nnew||b.system?{}:vb(b,A),E=b.nnew||b.system||!b.storage_key_count||80>r.configMode?{}:
wb(b,A),u=b.nnew||b.system||!b.requires.length&&!b.resources.length?{}:xb(b,A);if(f)return Y["tab"+b.uuid];var v=function(b){var c=!1;if("keydown"==b.type&&a.isSelected()){if(27==b.keyCode)r.editor_enabled&&"vim"==r.editor_keyMap||(window.setTimeout(m,1),c=!0);else if(r.editor_enabled){var d={save:!0,find:!0,findNext:!0,findPrev:!0,replace:!0,replaceAll:!0},e=B.getEditor(),g=CodeMirror.keyName(b);e&&!e.hasFocus()&&"handled"==CodeMirror.lookupKey(g,e.getOption("keyMap"),function(a){if(d[a])return e.execCommand(a),
!0})&&(c=!0)}else 83==b.keyCode&&(b.ctrlKey||b.metaKey)&&(g=B.getEditor())&&(g.save(),c=!0);if(c)return b.stopPropagation(),b.preventDefault(),!1}};d={onShow:function(){x.each([F,B,E,u],function(a){if(a.onShow)a.onShow()});window.addEventListener("keydown",v,!1)},onClose:function(a){var b;x.each([F,B,E,u],function(c){if(c.onClose&&c.onClose(a))return b=!0,!1});b||window.removeEventListener("keydown",v,!0);return b},afterSelect:function(){if(b.uuid){var a=M.get().sub,c=A.getTabById(a);M.set(b.uuid,
(c?a:null)||"editor");document.title=b.name}x.each([F,B,u],function(a){a.afterSelect&&a.afterSelect()})}};return Y["tab"+b.uuid]=d},vb=function(a,b){var c=w("div",a.uuid,"script_setting_h"),d=w("div",a.uuid,"script_settings_c");c.textContent=e.getMessage("Settings");var m,f=function(){if("checkbox"==this.type||"button"==this.type)m={},m[this.key]=!this.oldvalue,ga(this.uuid,m);else if("text"==this.type||"textarea"==this.type||"select-one"==this.type){var a=n.getValue(this);m={};m[this.key]=a;ga(this.uuid,
m)}},h=n.createPosition(e.getMessage("Position_")+": ",{id:"position",uuid:a.uuid,name:"pos",pos:a.position,posof:a.positionof},f),g=n.createDropDown(e.getMessage("Run_at"),{id:"run_at",uuid:a.uuid,name:"run-at",value:a.run_at},[{name:"document-start",value:"document-start"},{name:"document-body",value:"document-body"},{name:"document-end",value:"document-end"},{name:"document-idle",value:"document-idle"},{name:"context-menu",value:"context-menu"},{name:e.getMessage("Default"),value:null}],f),l=n.createDropDown(e.getMessage("No_frames"),
{id:"noframes",uuid:a.uuid,name:"no_frames",value:a.noframes},[{name:e.getMessage("Yes"),value:!0},{name:e.getMessage("No"),value:!1},{name:e.getMessage("Default"),value:null}],f),t=n.createCheckbox(e.getMessage("Check_for_Updates"),{id:"check_for_updates",uuid:a.uuid,name:"upd",enabled:a.check_for_updates},f),p=function(b){return(a.options&&a.options.override?a.options.override[b]:null)||[]},y=U(e.getMessage("Original_includes"),{id:"includes",item:a},p("orig_includes"),{orig:!0,other_name:e.getMessage("User_excludes")}),
q=U(e.getMessage("Original_matches"),{id:"matches",item:a},p("orig_matches"),{orig:!0,other_name:e.getMessage("User_excludes")}),A=U(e.getMessage("Original_excludes"),{id:"excludes",item:a},p("orig_excludes"),{orig:!0,other_name:e.getMessage("User_includes")}),B=k("div","clear",a.uuid,"clear"),F=U(e.getMessage("User_includes"),{id:"includes",item:a},p("use_includes")),r=U(e.getMessage("User_matches"),{id:"matches",item:a},p("use_matches")),u=U(e.getMessage("User_excludes"),{id:"excludes",item:a},
p("use_excludes")),v=U(e.getMessage("Original_domain_whitelist"),{id:"connects",item:a},a.connects,{orig:!0}),x=U(e.getMessage("Temporary_domain_whitelist"),{id:"temp_connects",item:a},a.temp_connects),D=U(e.getMessage("User_domain_whitelist"),{id:"connects",item:a},p("use_connects")),p=U(e.getMessage("User_domain_blacklist"),{id:"blockers",item:a},p("use_blockers")),z=n.createCheckbox(e.getMessage("Apply_compatibility_options_to_required_script_too"),{id:"compatopts_for_requires",uuid:a.uuid,name:"",
enabled:a.compatopts_for_requires},f),H=n.createCheckbox(e.getMessage("Fix_wrappedJSObject_property_access"),{id:"compat_wrappedjsobject",uuid:a.uuid,name:"",enabled:a.compat_wrappedjsobject},f),N=n.createCheckbox(e.getMessage("Convert_CDATA_sections_into_a_chrome_compatible_format"),{id:"compat_metadata",uuid:a.uuid,name:"",enabled:a.compat_metadata},f),X=n.createCheckbox(e.getMessage("Replace_for_each_statements"),{id:"compat_foreach",uuid:a.uuid,name:"",enabled:a.compat_foreach},f),P=n.createCheckbox(e.getMessage("Fix_for_var_in_statements"),
{id:"compat_forvarin",uuid:a.uuid,name:"",enabled:a.compat_forvarin},f),da=n.createCheckbox(e.getMessage("Convert_Array_Assignements"),{id:"compat_arrayleft",uuid:a.uuid,name:"",enabled:a.compat_arrayleft},f),C=n.createCheckbox(e.getMessage("Add_toSource_function_to_Object_Prototype"),{id:"compat_prototypes",uuid:a.uuid,name:"",enabled:a.compat_prototypes},f),I=[z,H,N,X,P,da,C],z=k("div","section",a.uuid,"ta_opt"),N=k("div","section_head",a.uuid,"head_ta_opt"),H=k("div","section_content",a.uuid,"content_ta_opt");
N.textContent=e.getMessage("Settings");z.appendChild(N);z.appendChild(H);N=k("div","section",a.uuid,"ta_upd");P=k("div","section_head",a.uuid,"head_ta_upd");X=k("div","section_content",a.uuid,"content_ta_upd");P.textContent=e.getMessage("Updates");N.appendChild(P);N.appendChild(X);P=k("div","section",a.uuid,"ta_cludes");C=k("div","section_head",a.uuid,"head_ta_cludes");da=k("div","section_content",a.uuid,"content_ta_cludes");C.textContent=e.getMessage("Includes_Excludes");P.appendChild(C);P.appendChild(da);
var C=k("div","section",a.uuid,"ta_security"),fa=k("div","section_head",a.uuid,"head_ta_security"),Sa=k("div","section_content",a.uuid,"content_ta_security");fa.textContent=e.getMessage("XHR_Security");C.appendChild(fa);C.appendChild(Sa);var fa=k("div","section",a.uuid,"ta_compat"),Qa=k("div","section_head",a.uuid,"head_ta_compat"),Ra=k("div","section_content",a.uuid,"content_ta_compat");Qa.textContent=e.getMessage("GM_compat_options_");fa.appendChild(Qa);fa.appendChild(Ra);H.appendChild(h);H.appendChild(g.elem);
H.appendChild(l.elem);X.appendChild(t.elem);da.appendChild([y.elem,q.elem,A.elem,B,F.elem,r.elem,u.elem]);Sa.appendChild([v.elem,x.elem,D.elem,p.elem]);d.appendChild([z,N,P,C]);for(h=0;h<I.length;h++)Ra.appendChild(I[h].elem);a.awareOfChrome&&Object.keys(I).forEach(function(a){I[a].input.setAttribute("disabled","disabled");I[a].elem.setAttribute("title",e.getMessage("This_script_runs_in_Chrome_mode"))});d.appendChild(fa);var G=n.createTextarea(null,{name:"",uuid:a.uuid,id:"comment",value:a.options.comment});
G.elem.setAttribute("class","script_setting_wrapper");h=w("div",a.uuid,"save");g=n.createButton("save_button",a.uuid,e.getMessage("Save"),function(){f.apply(G.textarea,[])});h.appendChild(g);g=k("div","section",a.uuid,"ta_comment");l=k("div","section_head",a.uuid,"head_ta_comment");t=k("div","section_content",a.uuid,"content_ta_comment");l.textContent=e.getMessage("Comment");g.appendChild(l);g.appendChild(t);t.appendChild(G.elem);t.appendChild(h);d.appendChild(g);h=k("div","section",a.uuid,"ta_det");
g=k("div","section_head",a.uuid,"head_ta_det");l=k("div","section_content",a.uuid,"content_ta_det");g.textContent=e.getMessage("Details");h.appendChild(g);h.appendChild(l);g.textContent=e.getMessage("Details");var K=k("table","script_details",a.uuid,"script_details");[{label:e.getMessage("Size"),value:ka.formatBytes((a.code?a.code:a).length,2)},{label:e.getMessage("UUID"),value:a.uuid}].forEach(function(b){var c=k("tr","external_desc",a.uuid,b.label,"tr"),d=k("td","external_desc",a.uuid,b.label,"td1"),
e=k("td","",a.uuid,b.label,"td2");d.textContent=b.label;e.textContent=b.value;c.appendChild(d);c.appendChild(e);K.appendChild(c)});l.appendChild(K);d.appendChild(h);var J=b.appendTab("settings",c,d,function(){M.setSub("settings")});M.registerListener(a.uuid,"settings",function(){J.select()});return{}},Za=function(a,b){var c=k("table","script_desc",a.uuid,"outer_req2html"),d=0,m=[{label:e.getMessage("URL"),prop:"display_url"},{label:e.getMessage("Size"),prop:"data",fn:function(a){var b="?";a&&(void 0!==
a.length?b=a.length:void 0!==a.content&&(b=a.content.length));return ka.formatBytes(b,2)}},{label:e.getMessage("Subresource_Integrity"),prop:"sri",fn:function(a){return a?a.type+"="+a.value:e.getMessage("_not_set_")}},{label:e.getMessage("Last_updated"),prop:"ts",fn:function(a){return a?(new Date(a)).toString():"?"}}];a[b].forEach(function(g){var h=d+b;m.forEach(function(b){var d=k("tr","external_desc",a.uuid,b.prop,"tr"+h),e=k("td","external_desc",a.uuid,b.prop,"td1"+h),f=k("td","",a.uuid,b.prop,
"td2"+h);e.textContent=b.label;f.textContent=(b.fn?b.fn:function(a){return a})(g[b.prop]);d.appendChild(e);d.appendChild(f);c.appendChild(d)});var f=k("tr","external_desc_buttons",a.uuid,g.url,"tr"+h),p=k("td","",a.uuid,"buttons","td"+h);f.appendChild(p);c.appendChild(f);if(g.ts){var f=w("div",a.uuid,"delete_external"+h),y=n.createButton(a.uuid,"delete_external"+x.createUniqueId(g.url)+h,e.getMessage("Delete"),function(){zb(a.uuid,g.url);y.parentNode&&y.parentNode.removeChild(y)});f.appendChild(y);
p.appendChild(f)}d++});if(!d){var f=k("tr","script_desc",a.uuid,d,"tr"),h=k("td","script_desc",a.uuid,d,"td1");h.textContent=e.getMessage("No_entry_found");f.appendChild(h);c.appendChild(f)}return c},xb=function(a,b){var c=w("div","",a.uuid,"script_external_h");c.textContent=e.getMessage("Externals");var d=w("div","",a.uuid,"script_externals_c"),m=k("div","section",a.uuid,"ta_requires"),f=k("div","section_head",a.uuid,"head_ta_requires"),h=k("div","section_content",a.uuid,"content_ta_requires");f.textContent=
e.getMessage("Requires");m.appendChild(f);m.appendChild(h);h.appendChild(Za(a,"requires"));var f=k("div","section",a.uuid,"ta_resources"),h=k("div","section_head",a.uuid,"head_ta_resources"),g=k("div","section_content",a.uuid,"content_ta_resources");h.textContent=e.getMessage("Resources");f.appendChild(h);f.appendChild(g);g.appendChild(Za(a,"resources"));d.appendChild(m);d.appendChild(f);var l=b.appendTab("externals",c,d,function(){M.setSub("externals")});M.registerListener(a.uuid,"externals",function(){l.select()});
return{}},wb=function(a,b){var c=function(a,b){if("string"===typeof a){var c=a[0];a=a.substr(1);switch(c){case "b":return"true"===a;case "n":return Number(a);case "o":try{return JSON.parse(a)}catch(d){console.log("values: parseValueFromStorage: "+d)}return b;default:return a}}else return b},d=w("div","",a.uuid,"script_storage_h");d.textContent=e.getMessage("Storage");var m=w("div","",a.uuid,"script_storages_c"),f=k("div","section",a.uuid,"ta_storage"),h=k("div","section_head",a.uuid,"head_ta_storage"),
g=k("div","section_content",a.uuid,"content_ta_storage");h.textContent=e.getMessage("Storage");f.appendChild(h);f.appendChild(g);var l=k("textarea","storageta",a.uuid,"storage");l.setAttribute("wrap","off");l.setAttribute("wrap","off");l.setAttribute("spellcheck","false");h=n.createButton("storage_save_button",a.uuid,e.getMessage("Save"),function(){var b=null;try{b=JSON.parse(l.value)}catch(c){x.alert(e.getMessage("Unable_to_parse_this_"));return}var d=Object.keys(b),g=Object.keys(a.storage);d.concat(g).filter(function(a,
b,c){return c.lastIndexOf(a)===b}).forEach(function(c){if(-1==d.indexOf(c))$a(a.uuid,c);else if(-1==g.indexOf(c)||b[c]!==a.storage[c]){var e=$a,h=a.uuid,f;a:{f=b[c];var l=(typeof f)[0];switch(l){case "o":try{f=l+JSON.stringify(f)}catch(m){console.log(m);f=void 0;break a}break;default:f=l+f}}e(h,c,f)}})});g.appendChild(l);g.appendChild(h);m.appendChild(f);var t=b.appendTab("storage",d,m,function(){M.setSub("storage")});M.registerListener(a.uuid,"storage",function(){(function(){if(a.referrer&&void 0===
a.storage){var b=D();oa({referrer:a.referrer+".storage",uuid:a.uuid},function(a){if(a.items){var d={},e=a.items[0];Object.keys(e).forEach(function(a){d[a]=c(e[a])});b.resolve(d)}else b.reject();q.hide()});return b.promise()}return D.Pledge(a.storage)})().done(function(b){l.value=JSON.stringify(b,null,4);a.storage=b;l.removeAttribute("disabled")}).fail(function(){l.setAttribute("disabled",!0)});t.select()});return{}},ab=function(a){return a.replace("<$URL$>",V.url?gb.Base64.decode(V.url):"http://*/*")},
ub=function(a,b,c){var d=k("tr","editor_container p100100",a.uuid,"container");if(!a.nnew&&I(a.uuid,"lastI"))return Y["editor"+a.uuid]||{};a.nnew&&(a.code=ab(r.script_templates[0].value));var m=w("div",a.uuid,"script_editor_h"),f=m.inserted;m.textContent=e.getMessage("Editor");var h=w("div",a.uuid,"script_editor_c"),g=k("tr","editormenubar",a.uuid,"container_menu"),l=k("table","editor_container_o p100100 noborder",a.uuid,"container_o");l.appendChild(g);l.appendChild(d);h.appendChild(l);var t=function(){var b=
!1;d.editor&&(b=r.editor_enabled?b|(d.editor.changed&&d.editor.mirror.historySize().undo):d.editor.value!=a.code);return b},p=function(){CodeMirror.commands.trimTrailingSpacesIfEnabled(d.editor.mirror);I(a.uuid,"saveEm")},y=function(a,b,d){c&&c(b,d)},l=n.createImageButton(a.uuid,"save_to_disk",e.getMessage("Save_to_disk"),rea.extension.getURL("/layout/default/images/harddrive2.png"),function(){I(a.uuid,"saveToDisk")}),L=n.createImageButton(a.uuid,"save",e.getMessage("Save"),rea.extension.getURL("/layout/default/images/filesave.png"),
p),A=n.createImageButton(a.uuid,"cancel",e.getMessage("Editor_reset"),rea.extension.getURL("/layout/default/images/editor_cancel.png"),function(){confirm(e.getMessage("Really_reset_all_changes_"))&&d.editor&&(r.editor_enabled?d.editor.mirror.setValue(a.code):d.editor.value=a.code)}),B=n.createImageButton(a.uuid,"reset",e.getMessage("Full_reset"),rea.extension.getURL("/layout/default/images/script_cancel.png"),function(){confirm(e.getMessage("Really_factory_reset_this_script_"))&&v[a.uuid].fullReset(function(a){a.cleaned&&
y(null,!0,!1)})}),F=n.createImageButton(a.uuid,"close_script",e.getMessage("Close"),rea.extension.getURL("/layout/default/images/exit.png"),y),E=n.createImageButton(a.uuid,"lint_script",e.getMessage("Run_syntax_check"),rea.extension.getURL("/layout/default/images/check.png"),function(){window.setTimeout(function(){var a;r.editor_enabled&&(a=d.editor)&&(q.wait(),window.setTimeout(function(){a.mirror.performLint(!0);var b=window.JSHINT.errors;if(b&&b.length){1===b.length?bb(e.getMessage("One_error_or_hint_was_found_")):
bb(e.getMessage("0count0_errors_or_hints_were_found_",b.length));for(var c,d=0;c=b[d];d++)if(1<c.line){a.mirror.setCursor(c.line-1,c.character-1);a.mirror.focus();break}}else cb(e.getMessage("No_syntax_errors_were_found_"));q.hide()},100))},1)}),u;a.nnew&&(u=n.createDropDown(null,{value:r.script_templates[0].name,uuid:"template-select",name:"template-select"},r.script_templates.map(function(a){return{name:a.name,value:a.name}}),function(){var a=this;if(t()&&!confirm(e.getMessage("Really_reset_all_changes_")))a.value=
a.oldvalue;else{var b=null;r.script_templates.map(function(c){c.name===a.value&&(b=ab(c.value))});b?(this.oldvalue=a.value,d.editor&&(r.editor_enabled?(d.editor.mirror.setValue(b),d.editor.changed=!1):d.editor.value=b)):a.value=a.oldvalue}}));var z=n.createInput(e.getMessage("Update_URL_"),{id:"file_url",uuid:a.uuid,name:"uu",value:a.file_url});z.input.setAttribute("class","updateurl_input");z.elem.setAttribute("class","updateurl");var C=k("textarea","editorta",a.uuid,"editor");C.setAttribute("wrap",
"off");C.setAttribute("spellcheck","false");var G=k("td","editor_outer",a.uuid,"edit"),K=k("div","editor_100 editor_border",a.uuid,"edit"),H=k("div","editormenu",a.uuid,"editormenu");G.appendChild(K);g.appendChild(H);g.appendChild(z.elem);d.inserted||(K.appendChild(C),d.appendChild(G));v[a.uuid].saveToDisk=function(){if(d.editor){var b=r.editor_enabled?d.editor.mirror.getValue():d.editor.value;q.wait();return pa().done(function(){var c=new Blob([b],{type:"text/plain"});saveAs(c,x.safeFileName(a.name+
".user.js"))}).always(function(){q.hide()})}};a.system||(v[a.uuid].saveEm=function(b){if(d.editor){var c=!0;r.showFixedSrc&&(c=confirm(e.getMessage("Do_you_really_want_to_store_fixed_code_",e.getMessage("Show_fixed_source"))));var g=r.editor_enabled?d.editor.mirror.getValue():d.editor.value;c&&Ka(a.uuid,g,{old_url:z.input?z.input.oldvalue:"",new_url:z.input?z.input.value:"",clean:!1,new_script:a.nnew,auto_save:b&&b.auto_save,reload:!0,lastModTime:v[a.uuid].saveEm_lastModTime}).done(function(c){c.installed?
a.nnew?y(null,!0,!1):(d.editor.changed=!1,c.lastModified&&(a.lastModTime=c.lastModified)):c.aborted||b&&b.auto_save||(c.messages&&c.messages.errors&&c.messages.errors.length?x.alert(c.messages.errors.join("\n")):x.alert(e.getMessage("Unable_to_parse_this_")))});return c}},H.appendChild(l),H.appendChild(L),H.appendChild(A));a.nnew||H.appendChild(B);H.appendChild(F);!a.system&&r.editor_enabled&&H.appendChild(E);a.nnew&&H.appendChild(u.elem);var N=b.appendTab("editor",m,h,function(){M.setSub("editor")});
M.registerListener(a.uuid,"editor",function(){N.select();r.editor_enabled&&d.editor&&(d.editor.refresh(),d.editor.mirror.focus())});if(f)return Y["editor"+a.uuid];var X,P,da=function(a,b,c,d){a=d.getValue();if(a.length<r.editor_autoLintMaxLen){if(!P){var e=d.getHelper(CodeMirror.Pos(0,0),"lint");P=window.setTimeout(function(){P=null;X=!0;var g=e(a,c,d);b(g)},1)}}else X&&(b([]),X=!1)},J=function(a){sa("editor_theme",a,!0).done(function(){cb("Theme switched to "+a)})},O=function(){r.editor_autoSave&&
t()&&I(a.uuid,"saveEm",{auto_save:!0})};b={getEditor:function(){if(d.editor)return r.editor_enabled?d.editor.mirror:{save:p}},onShow:function(){(function(){if(a.referrer&&void 0===a.code){var b=D();oa({referrer:a.referrer+".source",uuid:a.uuid},function(c){c.items?(a.code=c.items[0],b.resolve()):b.reject();q.hide()});return b.promise()}return D.Pledge()})().done(function(){var b=h.getElementsByTagName("textarea");v[a.uuid].lastI=function(){return a};if(b.length&&!d.editor){var b=b[0],c=function(){d.editor&&
(d.editor.changed=!0)};if(r.editor_enabled){var g=b.parentNode;g.removeChild(b);d.editor=new MirrorFrame(g,{theme:r.editor_theme,fontSize:r.editor_fontSize,themeOptions:{all:za.getEditorThemes().map(function(a){return a.value}),onChange:J},value:a.code,indentUnit:Number(r.editor_indentUnit),indentWithTabs:"tabs"==r.editor_indentWithTabs,smartIndent:"classic"!=r.editor_tabMode,indentByTab:"indent"==r.editor_tabMode,electricChars:"true"==r.editor_electricChars.toString(),lineNumbers:!0,lineWrapping:r.editor_lineWrapping,
extraKeys:{Enter:"newlineAndIndentContinueComment"},keyMap:r.editor_keyMap,bookmarkGutter:!0,gutters:["gutter","CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers","CodeMirror-bookmarks"],matchBrackets:!0,foldGutter:!0,styleActiveLine:!0,specifyMoreJsTokens:!0,styleSelectedText:!0,autoTrimTrailingSpace:"true"==r.editor_trimTrailingSpacesFromModifiedLines.toString(),hintOptions:{keywords:ya.globals},lint:{lintOnChange:r.editor_autoLint,async:r.editor_autoLint,getAnnotations:da,
globals:ya.globals,jshint_options:ya.options},showTrailingSpace:r.editor_highlightTrailingWhitespace},{save:p,close:y},{change:c,blur:O},e.getMessage)}else d.editor=b,b.value=a.code}}).fail(function(){y(null,!1,!0)})},onClose:function(b){var c=function(){d.editor=null;delete v[a.uuid].lastI};if(!b&&t())return(b=confirm(e.getMessage("There_are_unsaved_changed_")))&&c(),!b;c();return!1}};return Y["editor"+a.uuid]=b},lb=function(a,b,c){v[a.uuid]||(v[a.uuid]={});var d,m,f=a.icon&&!a.nativeScript,h=["script_name"];
a.nativeScript||h.push("clickable");a.blacklisted&&h.push("crossedout");var g=k("span",h.join(" "),a.uuid,"sname"),l=k("img","nameNicon16 icon16",a.uuid,"sname_img"),t=k("span",f?"nameNname16":"",a.uuid,"sname_name"),p=Ja(a),h=e.getTranslation(a,"name");t.textContent=35<h.length?h.substr(0,35)+"...":h;h=w("span",a.uuid,"spos");h.textContent=a.position||"";var q=w("span",a.uuid,"sversion");q.textContent=a.version?a.version:"";f&&(l.src=a.icon,g.appendChild(l));var f=[],L=function(){window.setTimeout(function(){for(var d=
Object.keys(T),e,g=0;e=d[g];g++)if(e=T[e].script,e.uuid==a.uuid){ta(b,[e],null,c);break}Da()},1)},A=function(b,c){void 0===c&&(c=!b);a.uuid&&M.is(a.uuid)&&M.clear();m&&m.onClose&&m.onClose(b)||(d&&(d.remove(),d=null),delete Y["tab"+a.uuid],delete Y["editor"+a.uuid],g.parentNode&&g.parentNode.removeChild(g),c&&L())},B=function(){m&&m.afterSelect&&m.afterSelect()},F=v[a.uuid].scriptClick=function(g,h){if(!d){var f=null;a.nnew?(f=k("div","head_icon",a.uuid,"details_h"),f.appendChild(n.createImage(a.imageURL,
"",a.uuid,"new_script_head"))):f=w("div",a.uuid,"details_h");var l=w("div",a.uuid,"details_c");d=c.insertTab(null,a.uuid,f,l,B,a.nnew?null:A);a.nnew||d.setHeading(e.getMessage("Edit")+" - "+(25<a.name.length?a.name.substr(0,25)+"...":a.name));m=yb(d,a,b,l,A)}if(m&&m.onShow)m.onShow();d.show();g&&1==g.button||h||d.select();t.setAttribute("open","true")};"true"==t.getAttribute("open")&&F(null,!0);var l=function(a,b){var c=a.getTime(),d=b.getTime(),e=Math.abs(c-d),c=Math.round(e/6E4),d=Math.round(e/
36E5),e=Math.round(e/864E5);return 60>=c?c+" min":48>=d?d+" h":e+" d"},E=w("span","",a.uuid,"last_updated",!0),u="";if(a.nativeScript||a.nnew||a.system)u="";else if(v[a.uuid].scriptUpdate=function(){var b=E.textContent;E.textContent="";E.appendChild(n.createImage(rea.extension.getURL("/layout/default/images/download.gif"),"down",a.uuid));Ab(a.uuid,function(c){E.textContent=b;c?($(E).addClass("green"),E.title=e.getMessage("There_is_an_update_for_0name0_avaiable_",a.name),A(!0),db()):($(E).addClass("red"),
E.title=e.getMessage("No_update_found__sry_"))})},a.options.check_for_updates&&a.file_url?(E.addEventListener("click",function(){I(a.uuid,"scriptUpdate")}),E.setAttribute("class","clickable"),E.title=e.getMessage("Check_for_Updates")):(E.setAttribute("class","greyed italic"),E.title=e.getMessage("Update_check_is_disabled")),a.lastModified||a.lastUpdated)try{u=l(new Date,new Date(a.lastModified||a.lastUpdated))}catch(H){console.log("o: error calculating time "+H.message)}else u="?";E.textContent=u;
var z=w("div",a.uuid,"imported"),D="";C.push(function(){r.sync_enabled&&(D=a.nativeScript||a.nnew||a.system?"":a.sync&&a.sync.imported?a.sync.imported==Oa.types.eCHROMESYNC?'<img src="https://www.google.com/images/icons/product/chrome-16.png" class="icon16" title="Google Sync"/>':a.sync.imported==Oa.types.eGDRIVE?'<img src="https://www.google.com/images/icons/product/drive-16.png" class="icon16" title="Google Drive"/>':'<img src="'+rea.extension.getURL("/layout/default/images/update.png")+'" class="icon16" />':
"",z.innerHTML=D,z=null)});l=w("span",a.uuid,"hp");if(a.origin){u=w("a",a.uuid,"hp");u.setAttribute("href",a.origin.url);u.setAttribute("target","_blank");var G=n.createImage(K.origin(a.origin.token),"",a.uuid,a.origin.token);u.appendChild(G);l.appendChild(u)}p&&(u=w("a",a.uuid,"hp"),u.setAttribute("href",p),u.setAttribute("target","_blank"),p=n.createImage(rea.extension.getURL("/layout/default/images/home.png"),"",a.uuid,"homepage",""),u.appendChild(p),l.appendChild(u));v[a.uuid].saveEm_lastModTime=
a.lastModified;v[a.uuid].fullReset=function(c){Ka(a.uuid,null,{clean:!0,reload:!0}).done(c||function(){});b.parentNode.removeChild(b)};v[a.uuid].reportAnIssue=function(b){Bb(a.uuid,b)};v[a.uuid].deleteScript=function(c,d){var g;a.nativeScript?(g=d||confirm(e.getMessage("Really_delete_0name0__",a.name)),1==g&&(La(a.uuid,"installed","false"),b.parentNode.removeChild(b))):(g=d||confirm(e.getMessage("Really_delete_0name0__",a.name)),1==g&&(Ka(a.uuid,null,{reload:!d}),b.parentNode.removeChild(b)))};p=
[];if(a.nativeScript){v[a.uuid].importNativeScript=function(c,d){1==(d||confirm(e.getMessage("Really_import_0name0__",a.name)))&&(La(a.uuid,"imported","true"),b.parentNode.removeChild(b))};var J=n.createImage(K.get("import"),"",a.uuid,"import",e.getMessage("Import"),function(){I(a.uuid,"importNativeScript")});n.addClass(J,"hidden");p.push(J);C.push(function(){r.native_import&&n.toggleClass(J,"hidden")})}a.nnew||a.system||a.nativeScript||(u=n.createImage(K.get("edit"),"",a.uuid,"edit",e.getMessage("Edit"),
function(){I(a.uuid,"scriptClick")}),p.push(u));a.nnew||a.system||(u=n.createImage(K.get("delete"),"",a.uuid,"delete",e.getMessage("Delete"),function(){I(a.uuid,"deleteScript")}),p.push(u));a.nnew||a.system||!a.origin||a.supportURL===a.origin.issue_url||(u=n.createImage(K.get("flag"),"",a.uuid,"issue",e.getMessage("Report_an_issue_to_the_script_hoster_"),function(){I(a.uuid,"reportAnIssue","hoster")}),p.push(u));a.nnew||a.system||!a.supportURL||(u=n.createImage(K.get("bug"),"",a.uuid,"bug",e.getMessage("Report_a_bug"),
function(){I(a.uuid,"reportAnIssue","author")}),p.push(u));g.inserted||a.nativeScript||(g.addEventListener("click",F),g.addEventListener("auxclick",F));g.appendChild(t);u=[a.name];a.description&&u.push(e.getTranslation(a,"description"));a.blacklisted&&(u=[e.getMessage("This_script_is_blacklisted_")]);g.title=u.join("\n\n").replace(/\"/g,'"');f.push(a.nnew||a.system?null:{element:Cb(a),style:"script_sel"});f.push(h);f.push(function(){var b=null,b=a.blacklisted?"enabler_warning":a.enabled?a.contexter?
"enabler_enabled enabler_later":"enabler_enabled":"enabler_disabled",c=a.blacklisted?e.getMessage("This_script_is_blacklisted_"):a.enabled?e.getMessage("Enabled"):e.getMessage("Disabled"),b=n.createEnabler(b,a.uuid,"enabled",{append:"enabled",disabled:a.blacklisted,title:c,on:e.getMessage("On"),off:e.getMessage("Off")},function(){I(a.uuid,a.nativeScript?"switchNativeEnabled":"switchEnabled")});v[a.uuid].switchEnabled=function(b,c,d){void 0===c&&(c=!a.enabled);ga(a.uuid,{enabled:c},d)};v[a.uuid].switchNativeEnabled=
function(b,c,d){void 0===c&&(c=!a.enabled);La(a.uuid,"enabled",c,d)};return b}());f.push(g);f.push(q);f.push(Db(a));f.push(z);f.push(Eb(a));f.push(Fb(a));f.push(l);f.push(E);f.push(Gb(a));f.push(function(a,b){var c=w("span",a.uuid,"wrap");b&&("Array"===x.toType(b)?x.each(b,function(a){c.appendChild(a)}):c.appendChild(b));return c}(a,p));for(h=f.length;10>h;h++)f.push(null);M.registerListener(a.uuid,function(){F()});a.nnew&&C.push(function(){F(null,!0)});return f},Db=function(a){var b=k("span","script_type",
"",a.uuid,"pos_type",!0);if(a.nnew)return b;a.nativeScript?(a=n.createImage(a.icon,"",a.uuid,"chrome_ext",e.getMessage("This_is_a_chrome_extension")),b.appendChild(a)):a.userscript&&(a=n.createImage("images/txt.png","",a.uuid,"user_script",e.getMessage("This_is_a_userscript")),b.appendChild(a));return b},Fb=function(a){var b,c,d=w("span","",a.uuid,"pos_features",!0);if(a.nnew)return d;a.system&&(b=n.createImage(rea.extension.getURL("/layout/default/images/lock.png"),"",a.uuid,"lock",e.getMessage("This_is_a_system_script")),
d.appendChild(b));a.warnings&&a.warnings.forEach(function(c,e){b=n.createImage(rea.extension.getURL("/layout/default/images/critical.png"),"compat",a.uuid,"warning_"+e,c);$(b).addClass("flashing");d.appendChild(b)});if(a.awareOfChrome||a.nativeScript)b=n.createImage("https://www.google.com/images/icons/product/chrome-16.png","",a.uuid,"chrome_mode",e.getMessage("This_script_runs_in_Chrome_mode")),d.appendChild(b);if(a.nativeScript)return d;a.requires.length&&(b=n.createImage(rea.extension.getURL("/layout/default/images/script_download.png"),
"",a.uuid,"requires",x.map(x.select(a.requires,function(a){return a&&a.url}),function(a){return a.url}).join("\n")),d.appendChild(b));a.resources.length&&(b=n.createImage(rea.extension.getURL("/layout/default/images/resources.png"),"",a.uuid,"resources",x.map(x.select(a.resources,function(a){return a&&a.url}),function(a){return a.url}).join("\n")),d.appendChild(b));var m=!1,f={includes:!0,matches:!0};for(c in f)if(a[c]){for(f=0;f<a[c].length;f++)if(a[c][f]&&(0==a[c][f].search(/\/\^?http(s|\.\*?|s\?|\[[^\]]*s[^\]]*\]|\([^\)]*s[^\)]*\))+/)||
0==a[c][f].search(/http[s\*]{1,1}|\*/))){b=n.createImage(rea.extension.getURL("/layout/default/images/halfencrypted.png"),"",a.uuid,"encrypt",e.getMessage("This_script_has_access_to_https_pages"));d.appendChild(b);m=!0;break}if(m)break}var h={};a.grant.forEach(function(a){h[a]=!0});h.GM_xmlhttpRequest&&(b=n.createImage(rea.extension.getURL("/layout/default/images/web.png"),"",a.uuid,"web",e.getMessage("This_script_has_full_web_access")),d.appendChild(b));h.GM_setValue&&(b=n.createImage(rea.extension.getURL("/layout/default/images/db.png"),
"",a.uuid,"db",e.getMessage("This_script_stores_data")),d.appendChild(b));h.unsafeWindow&&(b=n.createImage(rea.extension.getURL("/layout/default/images/windowlist.png"),"",a.uuid,"unsafeWindow",e.getMessage("This_script_has_access_to_webpage_scripts")),d.appendChild(b));for(c in a.options)if(-1!=c.search("compat_")&&a.options[c]){b=n.createImage(rea.extension.getURL("/layout/default/images/critical.png"),"compat",a.uuid,"crit",e.getMessage("One_or_more_compatibility_options_are_set"));d.appendChild(b);
break}return d},Xa=function(a){var b="global_hint_"+(a.class?a.class:"warning"),c=Date.now(),d=k("span",["global_hint",b].join(" "),"globalhint",c),b=w("span","globalhint_c",c),e=w("span","globalhint_t",c);a.title&&(e.title=a.title);a.image&&b.appendChild(n.createImage(K.get(a.image),"globalhint_"+c,"icon"+c));e.textContent=a.text;a.onclick&&!e.inserted&&e.addEventListener("click",a.onclick);b.appendChild(e);d.appendChild(b);var f=$(d).hide().appendTo(document.body);window.setTimeout(function(){f.slideDown()},
f.delay?f.delay:1);a.timeout&&window.setTimeout(function(){f.slideUp(function(){f.remove()});a.done&&a.done(d)},a.timeout);return f},eb=!1,Ya=function(){if(!eb){var a=e.getLocale(),b=$("<div>").hide(),c=function(a){a?(b.html(""),b.append($('<div class="contrib_iframe" style="font-size: 2.5em;"></div>').append($('<div style="padding-top: 150px;">').text(a))),window.setTimeout(c,1E3)):(b.fadeOut(1E3),window.setTimeout(q.hideDialog,1E3))},a=$('<iframe src="https://tampermonkey.net/contrib.php?embedded=true'+
(a?"&locale="+a:"")+'" class="contrib_iframe"></iframe>'),d=[$('<button class="contrib_button">').html(e.getMessage("Remind_me_later")).click(function(){ha("later",{});c(e.getMessage("Ok"))}),$('<button class="contrib_button">').html(e.getMessage("I_contributed_already")).click(function(){ha("contributed",{});c(e.getMessage("Thank_you_very_much_"))}),$('<button class="contrib_button">').html(e.getMessage("I_dont_want_to_contribute")).click(function(){ha("hide",{});c(e.getMessage("Ok"))})],m=function(){f&&
window.clearTimeout(f);d.forEach(function(a){a.prop("disabled",!1)})};d.forEach(function(a){a.prop("disabled",!0)});b.append(a,d);a.bind("load",m);var f=window.setTimeout(function(){f=null;m()},15E3),h=function(){var a=q.dialog(b[0]);!0===a?(b.fadeIn(1E3),ha("dialog",{})):void 0===a&&window.setTimeout(h,500);eb=!0};h();window.addEventListener("message",function(a){var d=a.data.clicked||a.data.type,h=a.data.amount,f=a.data.currency;d&&(a.data.success?(a=$(".contrib_iframe"),d=a.data("oheight"),!d||
0>d||1E3<d||a.animate({height:d},1E3)):(ha("clicked",d,{amount:h||"?",currency:f||"?"}),$(".contrib_button").remove(),b.append($('<button class="contrib_button">').html(e.getMessage("Ok")).click(function(){ha("contributed",{});c()})),a.data.enlarge&&(a=$(".contrib_iframe"),a.data("oheight",a.height()),a.animate({height:740},1E3))))},!1)}},Hb=function(){var a=null,b=null,c=null,d=0,e=0,f=0,h=function(b){var d=c.x+b.pageX;a.style.top=c.y+b.pageY+"px";a.style.left=d+"px"},g,l,k,p=function(c){if(a&&!g){var B,
r=null,v,u,w,x;h(c);l&&(window.clearTimeout(l),l=null);for(;r!=f;)r=f,v=b.previousSibling,u=b.nextSibling,w=b.parentNode,x=q(b),c.pageY>x.y+d+e&&u?(w.removeChild(u),w.insertBefore(u,b),f++,B=!1):c.pageY<x.y&&1<f&&(w.removeChild(v),u?w.insertBefore(v,u):w.appendChild(v),f--,B=!0);r=Math.min(.03*document.documentElement.clientHeight,100);if(void 0!==B){u=B?$(v):$(u);if(u.length&&!n.isScrolledIntoView(u,{padding:r})){B=B?u.offset().top-r-u.height():u.offset().top-document.documentElement.clientHeight+
r+2*u.height();g=!0;var z=B-document.body.scrollTop;$("html, body").animate({scrollTop:B},0,function(){window.setTimeout(function(){g=!1;l=window.setTimeout(function(){l=null;k===c&&p({pageX:k.pageX,pageY:k.pageY+z})},100)},100)})}c.stopPropagation&&(c.stopPropagation(),c.preventDefault());k=c;return!1}}},q=function(a){a=a.getBoundingClientRect();return{x:a.left+window.pageXOffset,y:a.top+window.pageYOffset}},r=function(d){a.style.position="static";var e={};e[a.key]=f;ga(a.uuid,e);a=b=c=null;document.removeEventListener("mousemove",
p);document.removeEventListener("scroll",p);document.removeEventListener("mouseup",r);d.stopPropagation();d.preventDefault();return!1};return{start:function(g,l){var k=this.parentNode.parentNode,n=k.parentNode,t=n.parentNode.parentNode;a=this;b=n;d=b.offsetHeight;e=b.offsetHeight-k.clientHeight;c=q(t);c.x=-c.x-a.offsetWidth/2;c.y=-c.y-b.offsetHeight/2+2*e;a.style.position="absolute";h(g);f=l;document.addEventListener("mousemove",p);document.addEventListener("scroll",p);document.addEventListener("mouseup",
r);g.stopPropagation();g.preventDefault();return!1}}}(),Gb=function(a){var b=k("span","sorting","",a.uuid,"pos_images",!0);if(a.nnew||a.nativeScript)return b;"pos"==aa()&&"up"==ea()||b.setAttribute("style","display: none;");if(1<a.position||a.position<a.positionof){var c=k("span","clickable movable","position",a.uuid,!0);c.innerHTML="&#9776;";c.title=e.getMessage("Click_here_to_move_this_script");c.uuid=a.uuid;c.key="position";c.addEventListener("mousedown",function(b){Hb.start.apply(this,[b,a.position])});
b.appendChild(c)}return b},Eb=function(a){var b=w("span","",a.uuid,"site_images"),c=null;b.inserted&&(c=b,c.setAttribute("id",c.id+"foo"),b=w("span","",a.uuid,"site_images"));Ha.topIcons(a,7).forEach(function(a){b.appendChild(a,!0)});c&&c.parentNode.removeChild(c);return b},ib=function(a){var b=w("div",a.name,a.id,"filter");if(b.inserted)return b;var c=!1;v.filter={onShow:function(a){c||(p.value="",c=!0);f(!0);a&&$(p).focus()},onHide:function(){c=!1;f(!0,1)}};var d=null,m,f=function(a,b){if(!m||a)d&&
window.clearTimeout(d),r.show(),d=window.setTimeout(function(){for(var a=document.getElementsByName("scriptselectors"),b=[],d=0;d<a.length;d++)b.push(a[d]);m=!0;"matching_url"!=g&&"auto"!=g||!p.value.match(h.matching_url.match)?a=D.Pledge():(l=h.matching_url.update_interval||l,a=Ib(p.value));a.always(function(){m=!1;r.fadeOut()}).then(function(a){var d=new RegExp(x.escapeForRegExp(p.value),"i"),e=p.value;b.forEach(function(b){var f,l,k,m;(f=T[b.s_id])&&(l=f.script)&&(k=f.dom)&&(c?"auto"==g?Object.keys(h).every(function(b){var c=
h[b];return"auto"==b?!0:(m=c.check(l,c.ignore_case?d:e,a))?!1:!0}):(f=h[g],m=f.check(l,f.ignore_case?d:e,a)):m=!0,$(k).toggle(!!m),b.is_hidden=!m)})})},b||l)},h={auto:{name:e.getMessage("Auto"),update_interval:500},name:{name:"@name",check:function(a,b){return-1!=a.name.search(b)},ignore_case:!0},namespace:{name:"@namespace",check:function(a,b){return a.namespace&&-1!=a.namespace.search(b)},ignore_case:!0},author:{name:"@author",check:function(a,b){return a.author&&-1!=a.author.search(b)},ignore_case:!0},
grant:{name:"@grant",default:"GM_",check:function(a,b){return a.grant&&0<a.grant.filter(function(a){return-1!=a.search(b)}).length},ignore_case:!0},includes:{name:"@include/@match",check:function(a,b){return a.includes&&0<a.includes.filter(function(a){return-1!=a.search(b)}).length||a.matches&&0<a.matches.filter(function(a){return-1!=a.search(b)}).length},ignore_case:!0},comment:{name:e.getMessage("Comment"),check:function(a,b){return a.comment&&-1!=a.comment.search(b)},ignore_case:!0},url:{name:e.getMessage("Update_URL_"),
default:"https://",check:function(a,b){return a.file_url&&-1!=a.file_url.search(b)},ignore_case:!0},matching_url:{name:e.getMessage("Matching_URL"),update_interval:1500,default:"http://",match:/^https?:\/\/.*/,check:function(a,b,c){return c&&-1!=c.indexOf(a.uuid)}}},g="auto",l=h.auto.update_interval,t=n.createDropDown(e.getMessage("Filter_by"),{value:0,uuid:"sms-filter",name:"select"},Object.keys(h).map(function(a){return{name:h[a].name,value:a}}),function(){var a;a=this.value;a!=g&&(g=a,l=((a=h[g])?
a.update_interval:null)||h.auto.update_interval,a=(a?a.default:null)||"",p.value=p.value||a,f())});t.elem.setAttribute("class","float");t.elem.setAttribute("style","display: inline; text-align: right; padding-left: 10px;");var p=k("input","filter_text","sms","all",null);p.setAttribute("spellcheck","false");var q="";p.inserted||p.addEventListener("keyup",function(){q!=p.value&&(q=p.value,f())});var r=$(n.createImage(rea.extension.getURL("/layout/default/images/download.gif"),"wait_for_filter",a.uuid));
r.attr("style","vertical-align: middle;");r.hide();b.setAttribute("style","display: inline-block; position: relative;");b.appendChild(t.elem);b.appendChild(p);b.appendChild(r[0]);V.filter&&C.push(function(){v.multiselect.toggleRow(!0,!0);p.value=V.filter});return b},J=[],Cb=function(a){var b=w("input","",a.uuid,"sel");b.type="checkbox";b.s_id=a.uuid;b.name="scriptselectors";b.s_type=a.nativeScript?"n":"s";b.inserted||b.addEventListener("click",function(a){J=[];b&&J.push(b);a.ctrlKey||a.metaKey?v.multiselect.un_selectAll():
v.multiselect.single_click()});return b},hb=function(a){var b=k("input","multiselectcb","sms","all",null),c=k("div","filter multiselectcb clickable","sms2","all",null);b.inserted||(b.type="checkbox",b.addEventListener("click",v.multiselect.un_selectAll),c.addEventListener("click",function(){v.multiselect.toggleRow()}));var d=0,m=[{name:e.getMessage("__Please_choose__"),value:0},{name:e.getMessage("Enable"),value:1},{name:e.getMessage("Disable"),value:2},{name:e.getMessage("Toggle_Enable"),value:7}];
(z.RUNTIME.CAN_SAVEAS_ZIP||"undefined"!==typeof Blob)&&m.push({name:e.getMessage("Export"),value:3});m=m.concat([{name:e.getMessage("Trigger_Update"),value:5},{name:e.getMessage("Factory_Reset"),value:8},{name:e.getMessage("Remove"),value:6}]);m=n.createDropDown(e.getMessage("Apply_this_action_to_the_selected_scripts"),{value:0,uuid:"sms-select",name:"select"},m,function(){0==this.value?f.setAttribute("disabled","true"):f.removeAttribute("disabled");d=this.value});m.elem.setAttribute("class","float");
m.elem.setAttribute("style","display: inline-block;");var f=n.createButton("MultiSelectButton","start_button",e.getMessage("Start"),function(){if(0==d)console.log("option: ?!?!");else{var a=null;6==d?a=e.getMessage("Really_delete_the_selected_items_"):8==d&&(a=e.getMessage("Really_factory_reset_the_selected_items_"));if(!a||confirm(a)){for(var b=document.getElementsByName("scriptselectors"),c=[],a=0;a<b.length;a++)c.push(b[a]);for(var b={},f,k=!1,m=100,a=0;a<c.length;a++)if(c[a].checked&&!c[a].is_hidden)if(1==
d||2==d||7==d){f="n"==c[a].s_type?"switchNativeEnabled":"switchEnabled";var n;if(7==d){var r=T[c[a].s_id]?T[c[a].s_id].script:null;r&&(n=!r.enabled)}else n=1==d;void 0!==n&&(I(c[a].s_id,f,null,n,!1),k=!0)}else 3==d?b[c[a].s_id]=!0:5==d?(f="scriptUpdate",I(c[a].s_id,f)):6==d?(f="deleteScript",I(c[a].s_id,f,null,!0),k=!0,m=1500):8==d&&(f="fullReset",I(c[a].s_id,f),k=!0,m=1500);3==d&&(q.wait(),ua(b,{storage:ba}).then(function(a){q.wait();return z.RUNTIME.CAN_SAVEAS_ZIP?W.zip.create(a.scripts).progress(q.wait):
W.json.create(a.scripts).then(function(a){return new Blob([a],{type:"text/plain"})})}).then(function(a){return pa().done(function(){saveAs(a,"tampermonkey_scripts"+(z.RUNTIME.CAN_SAVEAS_ZIP?".zip":".txt"))})}).always(function(){q.hide()}));k&&(q.wait(e.getMessage("Please_wait___")),window.setTimeout(function(){db()},m))}}});f.setAttribute("class","action_button");f.setAttribute("disabled","true");a=w("div",a.name,a.id,"actions");a.setAttribute("style","display: inline-block;");a.appendChild(m.elem);
a.appendChild(f);m=n.createButton("MultiSelectButton","close_button",e.getMessage("Close"),function(){v.multiselect.toggleRow(!1)});m.setAttribute("style","right: 10px; position: absolute;");$(m).addClass("close_button");return{selAllm:b,selAll:c,actionBox:a,close:m}};(function(){var a=0;v.multiselect={};var b=!1;v.multiselect.toggleRow=function(a,d){var e=$(".multiselect");void 0===a&&(a=!b);a?(b=!0,e.addClass("multiselectvisible"),v.filter.onShow(d)):(b=!1,e.removeClass("multiselectvisible"),v.filter.onHide(),
v.multiselect.un_selectAll(!1))};v.multiselect.single_click=function(){for(var b=0,d=document.getElementsByName("scriptselectors"),e=!0,f=!1,h=!1,g=!0,k=!1,n=!1,p=0,q=0;q<d.length;q++){"n"==d[q].s_type?(h=!0,e=e&&d[q].checked,f=f||d[q].checked):"s"==d[q].s_type&&(n=!0,g=g&&d[q].checked,k=k||d[q].checked);var r=$(d[q]).closest("tr");d[q].checked?(p++,r.addClass("selected")):r.removeClass("selected")}!h||!e||n&&!g&&k||(b+=1);!n||!g||h&&!e&&f||(b+=2);b!=a&&(a=b,$(".multiselectcb").prop("checked",0!=
b?"checked":""));p&&v.multiselect.toggleRow(!0);v.multiselect.checkScroll&&v.multiselect.checkScroll()};v.multiselect.un_selectAll=function(b){3<++a&&(a=0);var d=!1,e=0,f=document.getElementsByName("scriptselectors");J=[];!0===b&&(a=2);for(var h=0;h<f.length;h++){var g=$(f[h]).closest("tr");!1===b?(f[h].checked=!1,g.removeClass("selected")):(0!=h||1!=a&&3!=a||"s"!=f[h].s_type||3<++a&&(a=0),d|="s"==f[h].s_type,f[h].checked=3==a||1==a&&"n"==f[h].s_type||2==a&&"s"==f[h].s_type,f[h].checked?(e++,g.addClass("selected"),
J.push(f[h])):g.removeClass("selected"));e&&v.multiselect.toggleRow(!0)}void 0===b?1<a&&!d&&(a=0):b||(a=0);$(".multiselectcb").prop("checked",0!=a?"checked":"")}})();var ia=null,O=function(){ia&&(window.clearTimeout(ia),ia=null)},va=null,Q=function(){Ma(e.getMessage("Operation_completed_successfully"),"button_ok","notice")},cb=function(a,b){void 0===b&&(b="button_ok");Ma(a,b,"information",8E3)},bb=function(a,b){void 0===b&&(b="error");Ma(a,b,"warning",8E3)},Ma=function(a,b,c,d){void 0===d&&(d=3E3);
va&&$(va).remove();va=Xa({text:a,image:b,class:c,delay:500,timeout:d,done:function(){va=null}})},R=function(){ia||(ia=window.setTimeout(function(){ia=null;q.wait(e.getMessage("Please_wait___"))},500))},qa=null,ja=null,S=function(a,b){null!=qa?(window.clearTimeout(qa),qa=null,S(a?a:ja.items,a?b:ja.with_scripts)):(ja={items:a,with_scripts:b},qa=window.setTimeout(function(){qa=null;ja.with_scripts&&(T={});ta(null,ja.items,null,G);q.hide();Da();ja=null},50))},Ib=function(a){var b=D();sendMessage({method:"determineScriptsToRun",
url:a},function(a){b.resolve(a.scripts||[])});return b.promise()},ha=function(a,b,c){var d=D();sendMessage({method:"begEvent",action:a,type:b,extra:c},function(a){d.resolve(a)});return d.promise()},Ga=function(a,b){try{var c=function(){b&&z.OPTIONPAGE.CLOSE_ALLOWED&&window.close()};b?sendMessage({method:"newTab",url:a},c):rea.tabs.getSelected(null,function(d){rea.tabs.sendMessage(d.id,{method:"loadUrl",url:a,newtab:b},c)})}catch(d){console.log("lU: "+d.message)}},rb=function(a,b){var c=D();try{R(),
sendMessage({method:"installScript",url:a,reload:b.reload},function(a){O();a.items?(Q(),S(a.items,!1)):q.hide();a.err?c.reject(a):c.resolve(a)})}catch(d){console.log("sS: "+d.message),c.reject({err:d.message})}return c.promise()},ob=function(a,b){var c=D();try{R(),sendMessage({method:"exportToJson",ids:a,options:b},function(a){Q();O();q.hide();a.json?c.resolve(a.json):c.reject()})}catch(d){console.log("eJ: "+d.message),c.reject({})}return c.promise()},Ia=function(a,b){var c=D();try{R(),sendMessage({method:"importFromJson",
json:a,reload:b.reload},function(a){O();a.reload?window.setTimeout(function(){rea.page.reload()},500):a.items?(Q(),S(a.items,!0)):q.hide();a.err?c.reject(a):c.resolve(a)})}catch(d){console.log("sS: "+d.message),c.reject({err:d.message})}return c.promise()},Ka=function(a,b,c){var d=D();void 0===c.reload&&(c.reload=!0);try{var e=c.new_url&&c.new_url!=c.old_url?c.new_url:"";c.auto_save||R();sendMessage({method:"saveScript",uuid:a,code:b,clean:c.clean,force:c.force,new_script:c.new_script,auto_save:c.auto_save,
force_url:e,lastModTime:c.lastModTime,reload:c.reload},function(a){c.auto_save||(Q(),O());a=a||{};a.items?S(a.items,!0):q.hide();!b&&c.reload&&q.hide();d.resolve(a)})}catch(f){console.log("sS: "+f.message),d.reject({err:f.message})}return d.promise()},sa=function(a,b,c){var d=D();try{R(),sendMessage({method:"setOption",name:a,value:b},function(a){O();Q();r=a.options||r;!c&&a.items?S(a.items,!1):q.hide();d.resolve(a)})}catch(e){console.log("sO: "+e.message),d.reject({err:e.message})}return d.promise()},
kb=function(a,b,c){var d=D();try{R(),sendMessage({method:"buttonPress",name:a,data:b},function(a){O();!c&&a.items?(Q(),S(a.items,!1)):q.hide();d.resolve(a)})}catch(e){console.log("sO: "+e.message),d.reject({err:e.message})}return d.promise()},oa=function(a,b){R();sendMessage({method:"loadTree",complete:a.complete,uuid:a.uuid,referrer:a.referrer,layout:a.layout},function(a){O();r=a.options||r;a.i18n&&e.setLocale(a.i18n);a.items?a.begging&&C.push(function(){window.setTimeout(Ya,100)}):a.error?alert(a.error):
confirm(e.getOriginalMessage("An_internal_error_occured_Do_you_want_to_visit_the_forum_"))&&(window.location.href="http://tampermonkey.net/bug");b(a)})},db=function(){oa({referrer:"options.scripts"},function(a){a.items?S(a.items,!0):q.hide()})},ga=function(a,b,c){void 0==c&&(c=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:c};for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);R();sendMessage(a,function(a){O();r=a.options||r;a.i18n&&e.setLocale(a.i18n);Q();a.items?S(a.items,!0):q.hide()})}catch(k){console.log("mSo: "+
k.message)}},La=function(a,b,c,d){void 0===d&&(d=!0);try{a={method:"modifyNativeScript",nid:a,actionid:b,value:c,reload:d},R(),sendMessage(a,function(a){O();Q();a.items?S(a.items,!0):q.hide()})}catch(e){console.log("mSo: "+e.message)}},$a=function(a,b,c){try{a={method:"saveStorageKey",uuid:a,key:b,value:c,id:"options"},R(),sendMessage(a,function(){O();Q();q.hide()})}catch(d){console.log("sSk: "+d.message)}},qb=function(a,b,c){try{a={method:"download",details:{url:a,name:b,saveAs:!0},id:"options"},
R(),sendMessage(a,function(){O();Q();q.hide();c()})}catch(d){console.log("dDU: "+d.message)}},zb=function(a,b){try{R(),sendMessage({method:"buttonPress",name:"externals_delete",scriptuid:a,safe_url:b},function(a){O();Q();a.items?S(a.items,!1):q.hide()})}catch(c){console.log("dEx: "+c.message)}},Ab=function(a,b){try{sendMessage({method:"buttonPress",name:"run_script_updates",scriptuid:a},function(a){Q();b&&b(a.updatable)})}catch(c){console.log("rSu: "+c.message)}},Bb=function(a,b,c){try{sendMessage({method:"reportAnIssue",
uuid:a,to:b},function(){c&&c()})}catch(d){console.log("rRi: "+d.message)}};rea.extension.onMessage.addListener(function(a,b,c){if("updateOptions"==a.method)r=a.options||r,S(a.items,!1),c({});else if("confirm"==a.method)x.confirm(a.msg,function(a){c({confirm:a})});else if("showMsg"==a.method)x.alert(a.msg),c({});else return!1;return!0});(function(){oa({referrer:"options",layout:!0},function(a){tb();a.layout&&za.applyTheme(a.layout);if(a.options&&a.options.layout_user_css&&"reset"!==V.layout){var b=
document.createElement("style");b.innerHTML=a.options.layout_user_css;(document.head||document.body||document.documentElement||document).appendChild(b)}a.items?S(a.items,!1):q.hide()})})()})});
